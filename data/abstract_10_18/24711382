Vancomycin resistance in Gram-positive bacteria is due to production of cell-wall precursors ending in D-Ala-D-Lac or D-Ala-D-Ser, to which vancomycin exhibits low binding affinities, and to the elimination of the high-affinity precursors ending in D-Ala-D-Ala. Depletion of the susceptible high-affinity precursors is catalyzed by the zinc-dependent D,D-peptidases VanX and VanY acting on dipeptide (D-Ala-D-Ala) or pentapeptide (UDP-MurNac-L-Ala-D-Glu-L-Lys-D-Ala-D-Ala), respectively. Some of the vancomycin resistance operons encode VanXY D,D-carboxypeptidase, which hydrolyzes both di- and pentapeptide. The molecular basis for the diverse specificity of Van D,D-peptidases remains unknown. We present the crystal structures of VanXYC and VanXYG in apo and transition state analog-bound forms and of VanXYC in complex with the D-Ala-D-Ala substrate and D-Ala product. Structural and biochemical analysis identified the molecular determinants of VanXY dual specificity. VanXY residues 110-115 form a mobile cap over the catalytic site, whose flexibility is involved in the switch between di- and pentapeptide hydrolysis. Structure-based alignment of the Van D,D-peptidases showed that VanY enzymes lack this element, which promotes binding of the penta- rather than that of the dipeptide. The structures also highlight the molecular basis for selection of D-Ala-ending precursors over the modified resistance targets. These results illustrate the remarkable adaptability of the D,D-peptidase fold in response to antibiotic pressure via evolution of specific structural elements that confer hydrolytic activity against vancomycin-susceptible peptidoglycan precursors.