The spread of drug resistance represents a significant challenge to many disease control efforts. The evolution of resistance is a complex process influenced by transmission dynamics between hosts as well as infection dynamics within these hosts. This study aims to investigate how these two processes combine to impact the evolution of resistance in malaria parasites. We introduce a stochastic modelling framework combining an epidemiological model of Plasmodium transmission and an explicit within-human infection model for two competing strains. Immunity, treatment and resistance costs are included in the within-host model. We show that the spread of resistance is generally less likely in areas of intense transmission, and therefore of increased competition between strains, an effect exacerbated when costs of resistance are higher. We also illustrate how treatment influences the spread of resistance, with a trade-off between slowing resistance and curbing disease incidence. We show that treatment coverage has a stronger impact on disease prevalence, whereas treatment efficacy primarily affects resistance spread, suggesting that coverage should constitute the primary focus of control efforts. Finally, we illustrate the importance of feedbacks between modelling scales. Overall, our results underline the importance of concomitantly modelling the evolution of resistance within and between hosts.